#include <huffman.h>
#include <mcu.h>
#include <stdio.h>
#include <zigzag.h>

int main(int argc, char *argv[])
{
    (void) argc;
    (void) argv;

    // Test de get_huffman_from_freq
    uint8_t n = 6;
    uint32_t frequences[6] = {10, 100, 50, 37, 40, 50};
    struct huffman *huff = get_huffman_from_freq(frequences, n);
    description_huffman(huff, n);
    delete_huffman(huff);

    // Test de get_huffman_from_mcu
    printf("-----------------------------\n");

    int16_t bloc64[64] = {
        0x05, 0x03, 0x03, 0x05, 0x07, 0x0c, 0x0f, 0x12,
        0x04, 0x04, 0x04, 0x06, 0x08, 0x11, 0x12, 0x11,
        0x04, 0x04, 0x05, 0x07, 0x0c, 0x11, 0x15, 0x11,
        0x04, 0x05, 0x07, 0x09, 0x0f, 0x1a, 0x18, 0x13,
        0x05, 0x07, 0x0b, 0x11, 0x14, 0x21, 0x1f, 0x17,
        0x07, 0x0b, 0x11, 0x13, 0x18, 0x1f, 0x22, 0x1c,
        0x0f, 0x13, 0x17, 0x1a, 0x1f, 0x24, 0x24, 0x1e,
        0x16, 0x1c, 0x1d, 0x1d, 0x22, 0x1e, 0x1f, 0x1e
    };
    int16_t bloc128[128] = {
        0x05, 0x03, 0x03, 0x05, 0x07, 0x0c, 0x0f, 0x12,
        0x04, 0x04, 0x04, 0x06, 0x08, 0x11, 0x12, 0x11,
        0x04, 0x04, 0x05, 0x07, 0x0c, 0x11, 0x15, 0x11,
        0x04, 0x05, 0x07, 0x09, 0x0f, 0x1a, 0x18, 0x13,
        0x05, 0x07, 0x0b, 0x11, 0x14, 0x21, 0x1f, 0x17,
        0x07, 0x0b, 0x11, 0x13, 0x18, 0x1f, 0x22, 0x1c,
        0x0f, 0x13, 0x17, 0x1a, 0x1f, 0x24, 0x24, 0x1e,
        0x16, 0x1c, 0x1d, 0x1d, 0x22, 0x1e, 0x1f, 0x1e,
        0x05, 0x05, 0x07, 0x0e, 0x1e, 0x1e, 0x1e, 0x1e,
        0x05, 0x06, 0x08, 0x14, 0x1e, 0x1e, 0x1e, 0x1e,
        0x07, 0x08, 0x11, 0x1e, 0x1e, 0x1e, 0x1e, 0x1e,
        0x0e, 0x14, 0x1e, 0x1e, 0x1e, 0x1e, 0x1e, 0x1e,
        0x1e, 0x1e, 0x1e, 0x1e, 0x1e, 0x1e, 0x1e, 0x1e,
        0x1e, 0x1e, 0x1e, 0x1e, 0x1e, 0x1e, 0x1e, 0x1e,
        0x1e, 0x1e, 0x1e, 0x1e, 0x1e, 0x1e, 0x1e, 0x1e,
        0x1e, 0x1e, 0x1e, 0x1e, 0x1e, 0x1e, 0x1e, 0x1e
    };
    uint8_t sf[6] = {2, 1, 1, 1, 1, 1};
    struct array_mcu mcu;
    mcu.data = malloc(3*sizeof(uint16_t *));
    mcu.data[0] = bloc128;
    mcu.data[1] = bloc64;
    mcu.data[2] = bloc64;
    mcu.height = 1;
    mcu.width = 1;
    mcu.ct = COLOR;
    mcu.sf = sf;

    struct huffman **tableau_huffman = get_huffman_from_mcu(&mcu);
    uint8_t nelem[4] = {12, 11, 12, 11};
    for (size_t i = 0; i < 4; ++i) {
        description_huffman(tableau_huffman[i], nelem[i]);
        printf("*************************\n");
    }
    free(mcu.data);
    return EXIT_SUCCESS;
}
